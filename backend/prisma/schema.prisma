generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Offer {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 01-SİPARİŞ İLE İLGİLİ GENEL BİLGİLER
  teklifNo           String
  satisSorumlusu     String?
  siparisCinsi       String?
  musteriAdi         String
  yurtIciDisi        String?
  musteriTipi        String?
  siparisAdeti       Int?
  onayTarihi         DateTime?
  talepTarihi        DateTime?
  tipOnayDurumu      String?
  tescilUlkesi       String?
  sasiTipi           String?
  ustYapiTipi        String?
  teslimSekli        String?
  kamyonMarkasi      String?
  kamyonModeli       String?
  kamyonTahrikSistemi String?
  kamyonKabinTipi    String?
  kamyonTeslimTarihi DateTime?
  kamyonTalebi       String?

  // 02-KASA/KUVET İLE İLGİLİ BİLGİLER
  hacimTipi             String? // New
  hacim                 String? // m3, select options
  kasaUzunlugu          String?
  kasaGenisligi         String?
  kasaYuksekligi        String?
  sacKalinliklari       String? // Deprecated in frontend
  kuvetTabanSacKalinligi String? // New
  kuvetYanDuvarSacKalinligi String? // New
  kuvetOnDuvarSacKalinligi String? // New
  kuvetArkaKapakSacKalinligi String? // New
  damperSacMalzemesi    String?
  arkaKapakTipi         String?
  siperlik              String?
  emniyetKilitlemesi    String?
  brandaTipi            String?
  yagTanki              String?
  yagTankiMarkasi       String? // Deprecated in frontend? No, keep logic.
  silindirMarkasi       String?
  silindirTipi          String?
  kunekTipi             String? // Deprecated in frontend (typo)
  kurekTipi             String? // New
  govdeEtekSaci         String?

  // 03-ŞASİ/YÜRÜYEN İLE İLGİLİ BİLGİLER
  saseMalzemesi         String? // New
  dingilTipiVeAdeti     String? // New
  dingilMesafesi        String?
  dingillerArasiMesafe  String?
  besinciTekerYuksekligi String?
  disUzunluk            String? // Deprecated in frontend
  aracGenisligi         String? // Deprecated in frontend
  aracYuksekligi        String? // Deprecated in frontend
  dingilYuku            String?
  kingpinKapasitesi     String?
  mekanikAyak           String?
  elektrikSistemi       String?
  tampon                String?
  dingilMarkasi         String? // Deprecated in frontend
  dingilSayisi          String? // Deprecated in frontend
  dingilKaldirma        String? // Deprecated in frontend
  dingilKaldirmaKumandasi String? // Deprecated in frontend
  frenSistemi           String?
  frenSistemiMarkasi    String? // Deprecated in frontend
  guvenlikFrenFonksiyonu String? // Deprecated in frontend
  lastikMarkasi         String?
  lastikEbadi           String?
  toplamLastikJantAdeti String?
  jantMarkasi           String? // Deprecated in frontend
  jantTipi              String? // Deprecated in frontend
  stepneTasiyiciTipi    String? // Deprecated in frontend, replaced by stepneTasiyici
  stepneTasiyici        String? // New
  camurlukTipi          String?
  camurlukMarkasi       String? // Deprecated in frontend
  bisikletKorkulugu     String? // New

  // 04-DİĞER ÖZELLİKLER
  yanginDolabi          String?
  dolapTipi             String?
  suDeposu              String?
  isaretveLevhalar      String?
  merdiven              String?
  orjinalPto            String?
  hidrolikPompa         String?
  dengeKolu             String?
  cekiSeti              String?
  sasiRengi             String?
  damperKuvetRengi      String?
  brandaRengi           String?
  logo                  String?
  uyariEtiketDili       String?

  // Additional Fields
  ozelNotlar            String?

  // Relations
  items                 OfferItem[]
}

model OfferItem {
  id        String   @id @default(cuid())
  offerId   String
  offer     Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)
  
  imalatNo  String   @unique // Örn: IML-OZNL20240201-01
  status    String?  @default("Bekliyor") // Üretim durumu vb.
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --------------------------------------
// BOM (Bill of Materials) & STOCK SYSTEM
// --------------------------------------

model Product {
  id            String   @id @default(cuid())
  
  // Basic Info
  name          String   // Malzeme Adı (Örn: "ORTA BACAK")
  code          String?  @unique // Stok Kodu / Tedarikçi Kodu
  unit          String   // Birim (Örn: "Adet", "Kg", "Metre")
  category      String?  // Kategori
  supplier      String?  // Tedarikçi
  
  // Inventory Management
  currentStock  Float    @default(0)
  minStockLevel Float    @default(0)
  price         Float    @default(0)
  currency      String   @default("TRY") // TRY, USD, EUR
  
  // Relations
  bomRules      BomRule[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model BomRule {
  id            String   @id @default(cuid())
  
  // Condition
  groupName     String?  // Grup (Örn: "HİDROLİK DORSE", "GENEL")
  
  // Rule Logic:
  // If fieldName == "GLOBAL", it applies to ALL orders.
  // Otherwise, it applies only if Offer[fieldName] == fieldValue.
  // If fieldName2 is also set, BOTH conditions must match.
  fieldName     String   // Form Alanı (Örn: "arkaKapakTipi" veya "GLOBAL")
  fieldValue    String?  // Değer (Örn: "Hidrolik" veya null if GLOBAL)
  fieldName2    String?  // 2. Koşul Alan Adı (Opsiyonel)
  fieldValue2   String?  // 2. Koşul Değeri (Opsiyonel)
  
  // Result
  productId     String
  product       Product  @relation(fields: [productId], references: [id])
  
  quantity      Float    // Miktar 1 (Adet/Ana Miktar)
  quantity2     Float?   // Miktar 2 (Kg/Ek Miktar)
  
  @@index([fieldName, fieldValue])
}
